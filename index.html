<button id="connectBtn">Connect Wallet</button>

<script src="https://unpkg.com/@walletconnect/sign-client@2.3.0/dist/umd/index.min.js"></script>

<script>
let signClient;

(async () => {
  signClient = await WalletConnectSignClient.SignClient.init({
    projectId: "2ad273481a1b9553b3431f1ba8972c72",
    metadata: {
      name: "My DApp",
      description: "Mobile Login",
      url: "https://example.com",
      icons: []
    }
  });

  signClient.on("session_update", ({ session }) => {
    handleSession(session);
  });
})();

document.getElementById("connectBtn").addEventListener("click", async () => {

  // ðŸš¨ DO NOT await before redirect
  const connectPromise = signClient.connect({
    requiredNamespaces: {
      eip155: {
        methods: ["personal_sign"],
        chains: ["eip155:1"],
        events: []
      }
    }
  });

  connectPromise.then(({ uri, approval }) => {
    if (uri) {
      // âœ… THIS WORKS ON iOS SAFARI
      window.location.assign(uri);
    }

    approval().then(handleSession);
  });

});

function handleSession(session) {
  const account =
    session.namespaces.eip155.accounts[0].split(":")[2];

  alert("Connected: " + account);
}
</script>
